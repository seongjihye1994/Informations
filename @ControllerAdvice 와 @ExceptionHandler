ì„œë²„ì˜ ì—ëŸ¬ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•´ë³´ì.

ì„œë²„ ì—ëŸ¬ëŠ” ê³µí†µ ë¡œì§ì´ ë§¤ìš° ë§ë‹¤.

ì´ ì—ëŸ¬ê°€ ë‚˜ë©´, ì´ ë©”ì„¸ì§€ë¥¼ ë³´ì—¬ì¤˜ë¼~ ì™€ ê°™ì´

ê·¸ë˜ì„œ ì´ ê³µí†µ ë¡œì§ì„ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•´ë³´ì.

### Controller

```java
@RequestMapping("/drop")
public ResponseEntity<Object> dropReplication(@NotNull @RequestBody ReplicationDropObjInfo dropReplObj) {
    String replicationName = dropReplObj.getReplicationName();
    String localUserName = dropReplObj.getLocalUserName();
    List<String> localTableName = dropReplObj.getLocalTableName();

		// *** ì•„ë˜ 3ì¤„ DB ë¡œì§ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ìë™ìœ¼ë¡œ @ExceptionHandler ì´ ì¡ì•„ì¤€ë‹¤~
    **// í•´ë‹¹ Replication êµ¬ë™ ìƒíƒœ ì²´í¬
    checkReplStopStatusAndStopRepl(replicationName);

    // ì•„ë‹ˆë©´ ë¨¼ì € STOP í•œ í›„ drop items ì§„í–‰
    replicationService.startDropItems(localTableName, replicationName, localUserName);

    // ë§ˆì§€ë§‰ì—” ëª¨ë‘ start ì§„í–‰
    replicationService.startRepl(replicationName);**

		// ì •ìƒ ë¦¬í„´
    return ResponseEntity.ok().body("Replication Drop Items Success!");
}
```

ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì´ë‹¤.

Replication êµ¬ë™ ìƒíƒœë¥¼ ì²´í¬í•˜ê³ , Stop í•˜ê³ , Start í•˜ëŠ” ë¡œì§ì€ ëª¨ë‘ SQL Exception ì„ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.

ê·¸ë˜ì„œ ì›ë˜ë¼ë©´ try ~ catch ë¡œ ì¼ì¼ì´ ì—ëŸ¬ë¥¼ ì¡ì•„ì¤˜ì•¼ í–ˆì§€ë§Œ,

@ExceptionHandler ë¥¼ ì‚¬ìš©í•˜ë©´ ìë™ìœ¼ë¡œ í•´ë‹¹ ì—ëŸ¬ë¥¼ ì¡ì•„ ì²˜ë¦¬í•´ì¤€ë‹¤!

ì½”ë“œë¥¼ ë³´ì!

### ì „ì—­ì—ì„œ ì‚¬ìš©í•  Global Exception Handler Controller

```java
package com.ipageon.AltibaseReplication.error;

import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;

import java.nio.charset.Charset;
import java.sql.SQLException;

**@ControllerAdvice // ì „ì—­ì—ì„œ ì—ëŸ¬ì²˜ë¦¬**
@Slf4j
public class GlobalExceptionHandler {

    **@ExceptionHandler(SQLException.class) // SQL Exception ì´ ë°œìƒí•˜ë©´ ì•„ë˜ ë©”ì†Œë“œ í˜¸ì¶œ**
    public ResponseEntity<ErrorDTO> sqlException(SQLException e) {
        log.error(e.getMessage());

				// í—¤ë” ì •ì˜
        HttpHeaders header = new HttpHeaders();
        header.setContentType(new MediaType("application", "json", Charset.forName("UTF-8")));

				// body ì •ì˜
        ErrorDTO errorDTO = ErrorDTO.builder()
                .status(StatusEnum.BAD_REQUEST)
                .message(e.getMessage())
                .build();

				// í—¤ë”, ë°”ë””, ì‘ë‹µìƒíƒœ ë¦¬í„´
        return new ResponseEntity<>(errorDTO, header, HttpStatus.BAD_REQUEST);
    }
}
```

**@ExceptionHandler(SQLException.class) ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„ì—ì„œ ë§í–ˆë“¯ì´,**

SQL Exception ì´ ë°œìƒí•˜ë©´ ìë™ìœ¼ë¡œ ë°‘ì— ì •ì˜ëœ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•´ì„œ

ì—ëŸ¬ë¥¼ ì¡ì•„ì¤€ë‹¤!

ê·¸ë¦¬ê³  **@ControllerAdvice ëŠ” ì „ì—­ì—ì„œ global í•˜ê²Œ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ë„ë¡ í•œë‹¤.**

ResponseEntity ëŠ” HttpStatus ì˜ í—¤ë”ì™€ ë°”ë”” ê·¸ë¦¬ê³  ì‘ë‹µ ìƒíƒœê°€ í¬í•¨ëœ ê°ì²´ì´ë‹¤.

<aside>
ğŸš€ **ResponseEntity : headers + bodys + response status**

</aside>

### ì „ì—­ì—ì„œ ì‚¬ìš©í•  Global Exception Handler Controller

```java
package com.ipageon.AltibaseReplication.error;

import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;

import java.nio.charset.Charset;
import java.sql.SQLException;

@ControllerAdvice // ì „ì—­ì—ì„œ ì—ëŸ¬ì²˜ë¦¬
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(SQLException.class) // SQL Exception ì´ ë°œìƒí•˜ë©´ ì•„ë˜ ë©”ì†Œë“œ í˜¸ì¶œ
    public ResponseEntity<ErrorDTO> sqlException(SQLException e) {
        log.error(e.getMessage());

        HttpHeaders header = new HttpHeaders();
        header.setContentType(new MediaType("application", "json", Charset.forName("UTF-8")));

        ErrorDTO errorDTO = ErrorDTO.builder()
                .status(StatusEnum.BAD_REQUEST)
                .message(e.getMessage())
                .build();

        return new ResponseEntity<>(errorDTO, header, HttpStatus.BAD_REQUEST);

    }
}
```

ResponseEntity<> ì˜ ìŠ¤í¬ë¦½í‹€ë¦¿ ë‚´ë¶€ëŠ” ErrorDTO ë¥¼ ê¸°ì¬í–ˆë‹¤.

ResponseEntity ë¥¼ êµ¬ì„±í•˜ëŠ” ë°”ë””ë¥¼ DTO í˜•ì‹ìœ¼ë¡œ ë°›ì•„ ì²˜ë¦¬í•˜ë„ë¡ í–ˆë‹¤.

### ResponseEntityì˜ ë°”ë””ë¥¼ êµ¬ì„±í•˜ëŠ” ErrorDTO

```java
package com.ipageon.AltibaseReplication.error;

import lombok.Builder;
import lombok.Data;

@Data
@Builder
public class ErrorDTO {

    private StatusEnum status;
    private String message;
}
```

@Builder íŒ¨í„´ì„ ì‚¬ìš©í•´ì„œ ìƒì„±ìë¥¼ ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ë„ë¡ ì •ì˜í–ˆë‹¤.

ì—¬ê¸°ì— ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬ í•  ë°ì´í„°ê¹Œì§€ ì ì–´ì¤„ ìˆ˜ ìˆë‹¤.

ì´ì œ í´ë¼ì´ì–¸íŠ¸ì— ë¿Œë ¤ì£¼ì!

### index.html

```jsx
function addReplicationItem(url, selectObj) {
    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(selectObj), // bodyì˜ ë°ì´í„° ìœ í˜•ì€ ë°˜ë“œì‹œ "Content-Type" í—¤ë”ì™€ ì¼ì¹˜í•´ì•¼ í•¨
    }).then((response) => {
        if (!response.ok) { // ì‘ë‹µì´ okê°€ ì•„ë‹ˆë©´ response thorw
            throw response;
        }
        response.text() // ì‘ë‹µì´ ok ì´ë©´ textë¡œ ë°”ê¿”ì„œ ì½˜ì†”ì— ì°ì–´ì£¼ê³ , í™”ë©´ì— ë Œë”ë§
            .then(msg => {
                console.log(msg);
                renderResult(`success`, msg, `closeAddModalBtn`);
            }).catch(() => {
            throw response;
        });
        return response;
    }).catch((error) => { // ì‘ë‹µì´ okê°€ ì•„ë‹ˆë©´ textë¡œ ë°”ê¿”ì„œ ì½˜ì†”ì— ì°ì–´ì£¼ê³ , í™”ë©´ì— ë Œë”ë§
        error.json()
            .then(msg => {
                const status = msg.status;
                **if (status === `BAD_REQUEST`) { // ì—¬ê¸°ì„œ í¬ì¸íŠ¸! ì‘ë‹µ ìƒíƒœì— ë”°ë¼ í™”ë©´ì„ ë‹¤ë¥´ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ**
                    const message = msg.message;
                    renderResult(`error`, message, `closeAddModalBtn`);
                }
            });
    });
}
```
